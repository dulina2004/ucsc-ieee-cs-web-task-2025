<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Google Sheets Integration</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 50px auto;
                padding: 20px;
                background: #f5f5f5;
            }
            .container {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            h1 {
                color: #3b82f6;
            }
            button {
                background: #3b82f6;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                margin: 10px 5px;
            }
            button:hover {
                background: #2563eb;
            }
            .result {
                margin-top: 20px;
                padding: 15px;
                border-radius: 6px;
                display: none;
            }
            .success {
                background: #d1fae5;
                color: #065f46;
                border: 1px solid #10b981;
            }
            .error {
                background: #fee2e2;
                color: #991b1b;
                border: 1px solid #ef4444;
            }
            .info {
                background: #dbeafe;
                color: #1e40af;
                border: 1px solid #3b82f6;
            }
            pre {
                background: #1f2937;
                color: #f9fafb;
                padding: 15px;
                border-radius: 6px;
                overflow-x: auto;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üß™ Google Sheets Integration Test</h1>

            <div id="webhook-check" class="result info" style="display: block">
                <strong>Checking configuration...</strong>
            </div>

            <h2>Test Registrations</h2>
            <button onclick="testIndividual()">
                Test Individual Registration
            </button>
            <button onclick="testTeam()">Test Team Registration</button>
            <button onclick="checkWebhook()">Check Webhook URL</button>

            <div id="result" class="result"></div>
        </div>

        <script>
            const WEBHOOK_URL =
                "https://script.google.com/macros/s/AKfycbyxNa4VlThhVNwTRXEJFso01J5sYSWsq_b5GumD5HslQKsYrmc1VNZy4cbjU4NR5cGk/exec";

            // Check webhook on load
            window.onload = function () {
                const webhookDiv = document.getElementById("webhook-check");
                if (WEBHOOK_URL && WEBHOOK_URL.includes("script.google.com")) {
                    webhookDiv.innerHTML = `
                    <strong>‚úì Webhook URL is configured</strong><br>
                    <small>${WEBHOOK_URL}</small>
                `;
                    webhookDiv.className = "result success";
                } else {
                    webhookDiv.innerHTML =
                        "<strong>‚úó Webhook URL not configured properly</strong>";
                    webhookDiv.className = "result error";
                }
            };

            function showResult(message, type) {
                const resultDiv = document.getElementById("result");
                resultDiv.innerHTML = message;
                resultDiv.className = `result ${type}`;
                resultDiv.style.display = "block";
            }

            function checkWebhook() {
                showResult(
                    `
                <strong>Webhook Configuration:</strong><br>
                <pre>${WEBHOOK_URL}</pre>
                ${WEBHOOK_URL ? "‚úì URL is set" : "‚úó URL is not set"}
            `,
                    "info"
                );
            }

            async function testIndividual() {
                showResult(
                    "‚è≥ Sending individual registration test...",
                    "info"
                );

                const testData = {
                    registrationType: "individual",
                    teamName: "Solo Innovator",
                    name: "Test User",
                    email: "test@example.com",
                    institution: "UCSC",
                    role: "Student",
                };

                try {
                    console.log("Sending data:", testData);

                    const response = await fetch(WEBHOOK_URL, {
                        method: "POST",
                        mode: "no-cors",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(testData),
                    });

                    console.log("Response:", response);

                    showResult(
                        `
                    <strong>‚úì Individual Registration Sent!</strong><br><br>
                    <strong>Data sent:</strong>
                    <pre>${JSON.stringify(testData, null, 2)}</pre>
                    <strong>Note:</strong> Check your Google Sheet for the "Individual Registrations" sheet.<br>
                    Due to no-cors mode, we can't read the response, but if no error occurred, the data was likely sent successfully.
                `,
                        "success"
                    );
                } catch (error) {
                    console.error("Error:", error);
                    showResult(
                        `
                    <strong>‚úó Error sending registration</strong><br>
                    ${error.message}<br><br>
                    <strong>Troubleshooting:</strong><br>
                    1. Make sure the Google Apps Script is deployed as a Web App<br>
                    2. Check that "Who has access" is set to "Anyone"<br>
                    3. Verify the webhook URL is correct
                `,
                        "error"
                    );
                }
            }

            async function testTeam() {
                showResult("‚è≥ Sending team registration test...", "info");

                const testData = {
                    registrationType: "team",
                    teamName: "Test Dream Team",
                    teamSize: 3,
                    members: [
                        {
                            name: "Alice Johnson",
                            email: "alice@example.com",
                            institution: "UCSC",
                            role: "Student",
                        },
                        {
                            name: "Bob Smith",
                            email: "bob@example.com",
                            institution: "UCSC",
                            role: "Student",
                        },
                        {
                            name: "Charlie Brown",
                            email: "charlie@example.com",
                            institution: "UCSC",
                            role: "Student",
                        },
                    ],
                };

                try {
                    console.log("Sending data:", testData);

                    const response = await fetch(WEBHOOK_URL, {
                        method: "POST",
                        mode: "no-cors",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(testData),
                    });

                    console.log("Response:", response);

                    showResult(
                        `
                    <strong>‚úì Team Registration Sent!</strong><br><br>
                    <strong>Data sent:</strong>
                    <pre>${JSON.stringify(testData, null, 2)}</pre>
                    <strong>Note:</strong> Check your Google Sheet for the "Team Registrations" sheet.<br>
                    Due to no-cors mode, we can't read the response, but if no error occurred, the data was likely sent successfully.
                `,
                        "success"
                    );
                } catch (error) {
                    console.error("Error:", error);
                    showResult(
                        `
                    <strong>‚úó Error sending registration</strong><br>
                    ${error.message}<br><br>
                    <strong>Troubleshooting:</strong><br>
                    1. Make sure the Google Apps Script is deployed as a Web App<br>
                    2. Check that "Who has access" is set to "Anyone"<br>
                    3. Verify the webhook URL is correct
                `,
                        "error"
                    );
                }
            }
        </script>
    </body>
</html>
